<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Type.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">v3io-kafka-client</a> &gt; <a href="index.source.html" class="el_package">org.apache.kafka.common.protocol.types</a> &gt; <span class="el_source">Type.java</span></div><h1>Type.java</h1><pre class="source lang-java linenums">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.kafka.common.protocol.types;

import java.nio.ByteBuffer;

import org.apache.kafka.common.utils.Utils;

/**
 * A serializable type
 */
<span class="nc" id="L26">public abstract class Type {</span>

    /**
     * Write the typed object to the buffer
     *
     * @throws SchemaException If the object is not valid for its type
     */
    public abstract void write(ByteBuffer buffer, Object o);

    /**
     * Read the typed object from the buffer
     *
     * @throws SchemaException If the object is not valid for its type
     */
    public abstract Object read(ByteBuffer buffer);

    /**
     * Validate the object. If succeeded return its typed object.
     *
     * @throws SchemaException If validation failed
     */
    public abstract Object validate(Object o);

    /**
     * Return the size of the object in bytes
     */
    public abstract int sizeOf(Object o);

    /**
     * Check if the type supports null values
     * @return whether or not null is a valid value for the type implementation
     */
    public boolean isNullable() {
<span class="nc" id="L59">        return false;</span>
    }

    /**
     * The Boolean type represents a boolean value in a byte by using
     * the value of 0 to represent false, and 1 to represent true.
     *
     * If for some reason a value that is not 0 or 1 is read,
     * then any non-zero value will return true.
     */
<span class="nc" id="L69">    public static final Type BOOLEAN = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc bnc" id="L72" title="All 2 branches missed.">            if ((Boolean) o)</span>
<span class="nc" id="L73">                buffer.put((byte) 1);</span>
            else
<span class="nc" id="L75">                buffer.put((byte) 0);</span>
<span class="nc" id="L76">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L80">            byte value = buffer.get();</span>
<span class="nc bnc" id="L81" title="All 2 branches missed.">            return value != 0;</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L86">            return 1;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L91">            return &quot;BOOLEAN&quot;;</span>
        }

        @Override
        public Boolean validate(Object item) {
<span class="nc bnc" id="L96" title="All 2 branches missed.">            if (item instanceof Boolean)</span>
<span class="nc" id="L97">                return (Boolean) item;</span>
            else
<span class="nc" id="L99">                throw new SchemaException(item + &quot; is not a Boolean.&quot;);</span>
        }
    };

<span class="nc" id="L103">    public static final Type INT8 = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L106">            buffer.put((Byte) o);</span>
<span class="nc" id="L107">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L111">            return buffer.get();</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L116">            return 1;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L121">            return &quot;INT8&quot;;</span>
        }

        @Override
        public Byte validate(Object item) {
<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (item instanceof Byte)</span>
<span class="nc" id="L127">                return (Byte) item;</span>
            else
<span class="nc" id="L129">                throw new SchemaException(item + &quot; is not a Byte.&quot;);</span>
        }
    };

<span class="nc" id="L133">    public static final Type INT16 = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L136">            buffer.putShort((Short) o);</span>
<span class="nc" id="L137">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L141">            return buffer.getShort();</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L146">            return 2;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L151">            return &quot;INT16&quot;;</span>
        }

        @Override
        public Short validate(Object item) {
<span class="nc bnc" id="L156" title="All 2 branches missed.">            if (item instanceof Short)</span>
<span class="nc" id="L157">                return (Short) item;</span>
            else
<span class="nc" id="L159">                throw new SchemaException(item + &quot; is not a Short.&quot;);</span>
        }
    };

<span class="nc" id="L163">    public static final Type INT32 = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L166">            buffer.putInt((Integer) o);</span>
<span class="nc" id="L167">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L171">            return buffer.getInt();</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L176">            return 4;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L181">            return &quot;INT32&quot;;</span>
        }

        @Override
        public Integer validate(Object item) {
<span class="nc bnc" id="L186" title="All 2 branches missed.">            if (item instanceof Integer)</span>
<span class="nc" id="L187">                return (Integer) item;</span>
            else
<span class="nc" id="L189">                throw new SchemaException(item + &quot; is not an Integer.&quot;);</span>
        }
    };

<span class="nc" id="L193">    public static final Type INT64 = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L196">            buffer.putLong((Long) o);</span>
<span class="nc" id="L197">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L201">            return buffer.getLong();</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L206">            return 8;</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L211">            return &quot;INT64&quot;;</span>
        }

        @Override
        public Long validate(Object item) {
<span class="nc bnc" id="L216" title="All 2 branches missed.">            if (item instanceof Long)</span>
<span class="nc" id="L217">                return (Long) item;</span>
            else
<span class="nc" id="L219">                throw new SchemaException(item + &quot; is not a Long.&quot;);</span>
        }
    };

<span class="nc" id="L223">    public static final Type STRING = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L226">            byte[] bytes = Utils.utf8((String) o);</span>
<span class="nc bnc" id="L227" title="All 2 branches missed.">            if (bytes.length &gt; Short.MAX_VALUE)</span>
<span class="nc" id="L228">                throw new SchemaException(&quot;String length &quot; + bytes.length + &quot; is larger than the maximum string length.&quot;);</span>
<span class="nc" id="L229">            buffer.putShort((short) bytes.length);</span>
<span class="nc" id="L230">            buffer.put(bytes);</span>
<span class="nc" id="L231">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L235">            short length = buffer.getShort();</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            if (length &lt; 0)</span>
<span class="nc" id="L237">                throw new SchemaException(&quot;String length &quot; + length + &quot; cannot be negative&quot;);</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">            if (length &gt; buffer.remaining())</span>
<span class="nc" id="L239">                throw new SchemaException(&quot;Error reading string of length &quot; + length + &quot;, only &quot; + buffer.remaining() + &quot; bytes available&quot;);</span>

<span class="nc" id="L241">            byte[] bytes = new byte[length];</span>
<span class="nc" id="L242">            buffer.get(bytes);</span>
<span class="nc" id="L243">            return Utils.utf8(bytes);</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L248">            return 2 + Utils.utf8Length((String) o);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L253">            return &quot;STRING&quot;;</span>
        }

        @Override
        public String validate(Object item) {
<span class="nc bnc" id="L258" title="All 2 branches missed.">            if (item instanceof String)</span>
<span class="nc" id="L259">                return (String) item;</span>
            else
<span class="nc" id="L261">                throw new SchemaException(item + &quot; is not a String.&quot;);</span>
        }
    };

<span class="nc" id="L265">    public static final Type NULLABLE_STRING = new Type() {</span>
        @Override
        public boolean isNullable() {
<span class="nc" id="L268">            return true;</span>
        }

        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc bnc" id="L273" title="All 2 branches missed.">            if (o == null) {</span>
<span class="nc" id="L274">                buffer.putShort((short) -1);</span>
<span class="nc" id="L275">                return;</span>
            }

<span class="nc" id="L278">            byte[] bytes = Utils.utf8((String) o);</span>
<span class="nc bnc" id="L279" title="All 2 branches missed.">            if (bytes.length &gt; Short.MAX_VALUE)</span>
<span class="nc" id="L280">                throw new SchemaException(&quot;String length &quot; + bytes.length + &quot; is larger than the maximum string length.&quot;);</span>
<span class="nc" id="L281">            buffer.putShort((short) bytes.length);</span>
<span class="nc" id="L282">            buffer.put(bytes);</span>
<span class="nc" id="L283">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L287">            short length = buffer.getShort();</span>
<span class="nc bnc" id="L288" title="All 2 branches missed.">            if (length &lt; 0)</span>
<span class="nc" id="L289">                return null;</span>
<span class="nc bnc" id="L290" title="All 2 branches missed.">            if (length &gt; buffer.remaining())</span>
<span class="nc" id="L291">                throw new SchemaException(&quot;Error reading string of length &quot; + length + &quot;, only &quot; + buffer.remaining() + &quot; bytes available&quot;);</span>

<span class="nc" id="L293">            byte[] bytes = new byte[length];</span>
<span class="nc" id="L294">            buffer.get(bytes);</span>
<span class="nc" id="L295">            return Utils.utf8(bytes);</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc bnc" id="L300" title="All 2 branches missed.">            if (o == null)</span>
<span class="nc" id="L301">                return 2;</span>

<span class="nc" id="L303">            return 2 + Utils.utf8Length((String) o);</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L308">            return &quot;NULLABLE_STRING&quot;;</span>
        }

        @Override
        public String validate(Object item) {
<span class="nc bnc" id="L313" title="All 2 branches missed.">            if (item == null)</span>
<span class="nc" id="L314">                return null;</span>

<span class="nc bnc" id="L316" title="All 2 branches missed.">            if (item instanceof String)</span>
<span class="nc" id="L317">                return (String) item;</span>
            else
<span class="nc" id="L319">                throw new SchemaException(item + &quot; is not a String.&quot;);</span>
        }
    };

<span class="nc" id="L323">    public static final Type BYTES = new Type() {</span>
        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc" id="L326">            ByteBuffer arg = (ByteBuffer) o;</span>
<span class="nc" id="L327">            int pos = arg.position();</span>
<span class="nc" id="L328">            buffer.putInt(arg.remaining());</span>
<span class="nc" id="L329">            buffer.put(arg);</span>
<span class="nc" id="L330">            arg.position(pos);</span>
<span class="nc" id="L331">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L335">            int size = buffer.getInt();</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">            if (size &lt; 0)</span>
<span class="nc" id="L337">                throw new SchemaException(&quot;Bytes size &quot; + size + &quot; cannot be negative&quot;);</span>
<span class="nc bnc" id="L338" title="All 2 branches missed.">            if (size &gt; buffer.remaining())</span>
<span class="nc" id="L339">                throw new SchemaException(&quot;Error reading bytes of size &quot; + size + &quot;, only &quot; + buffer.remaining() + &quot; bytes available&quot;);</span>

<span class="nc" id="L341">            ByteBuffer val = buffer.slice();</span>
<span class="nc" id="L342">            val.limit(size);</span>
<span class="nc" id="L343">            buffer.position(buffer.position() + size);</span>
<span class="nc" id="L344">            return val;</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc" id="L349">            ByteBuffer buffer = (ByteBuffer) o;</span>
<span class="nc" id="L350">            return 4 + buffer.remaining();</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L355">            return &quot;BYTES&quot;;</span>
        }

        @Override
        public ByteBuffer validate(Object item) {
<span class="nc bnc" id="L360" title="All 2 branches missed.">            if (item instanceof ByteBuffer)</span>
<span class="nc" id="L361">                return (ByteBuffer) item;</span>
            else
<span class="nc" id="L363">                throw new SchemaException(item + &quot; is not a java.nio.ByteBuffer.&quot;);</span>
        }
    };

<span class="nc" id="L367">    public static final Type NULLABLE_BYTES = new Type() {</span>
        @Override
        public boolean isNullable() {
<span class="nc" id="L370">            return true;</span>
        }

        @Override
        public void write(ByteBuffer buffer, Object o) {
<span class="nc bnc" id="L375" title="All 2 branches missed.">            if (o == null) {</span>
<span class="nc" id="L376">                buffer.putInt(-1);</span>
<span class="nc" id="L377">                return;</span>
            }

<span class="nc" id="L380">            ByteBuffer arg = (ByteBuffer) o;</span>
<span class="nc" id="L381">            int pos = arg.position();</span>
<span class="nc" id="L382">            buffer.putInt(arg.remaining());</span>
<span class="nc" id="L383">            buffer.put(arg);</span>
<span class="nc" id="L384">            arg.position(pos);</span>
<span class="nc" id="L385">        }</span>

        @Override
        public Object read(ByteBuffer buffer) {
<span class="nc" id="L389">            int size = buffer.getInt();</span>
<span class="nc bnc" id="L390" title="All 2 branches missed.">            if (size &lt; 0)</span>
<span class="nc" id="L391">                return null;</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">            if (size &gt; buffer.remaining())</span>
<span class="nc" id="L393">                throw new SchemaException(&quot;Error reading bytes of size &quot; + size + &quot;, only &quot; + buffer.remaining() + &quot; bytes available&quot;);</span>

<span class="nc" id="L395">            ByteBuffer val = buffer.slice();</span>
<span class="nc" id="L396">            val.limit(size);</span>
<span class="nc" id="L397">            buffer.position(buffer.position() + size);</span>
<span class="nc" id="L398">            return val;</span>
        }

        @Override
        public int sizeOf(Object o) {
<span class="nc bnc" id="L403" title="All 2 branches missed.">            if (o == null)</span>
<span class="nc" id="L404">                return 4;</span>

<span class="nc" id="L406">            ByteBuffer buffer = (ByteBuffer) o;</span>
<span class="nc" id="L407">            return 4 + buffer.remaining();</span>
        }

        @Override
        public String toString() {
<span class="nc" id="L412">            return &quot;NULLABLE_BYTES&quot;;</span>
        }

        @Override
        public ByteBuffer validate(Object item) {
<span class="nc bnc" id="L417" title="All 2 branches missed.">            if (item == null)</span>
<span class="nc" id="L418">                return null;</span>

<span class="nc bnc" id="L420" title="All 2 branches missed.">            if (item instanceof ByteBuffer)</span>
<span class="nc" id="L421">                return (ByteBuffer) item;</span>

<span class="nc" id="L423">            throw new SchemaException(item + &quot; is not a java.nio.ByteBuffer.&quot;);</span>
        }
    };


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>